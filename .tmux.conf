# Reload binding should come AFTER prefix definition
# unbind -a -T prefix
# unbind -a -T root
# unbind -a -T copy-mode
# unbind -a -T copy-mode-vi

bind b source-file ~/.tmux.conf \; display-message "Config reloaded!"

# ═══════════════════════════════════════════════════════════════════
# Core Settings
# ═══════════════════════════════════════════════════════════════════
set -g prefix M-Space                                   # Set prefix to Alt+Space for faster typing
set -g default-terminal "screen-256color"              # Use 256 color terminal for better aesthetics
set -ga terminal-overrides ",xterm-256color:Tc"         # Enable true color support for accurate colors
set -g mouse on                                         # Enable mouse support for pane/window selection
set -g set-clipboard on                                 # Sync tmux clipboard with system clipboard
set -g escape-time 1                                    # Reduce escape key delay for faster response

# ═══════════════════════════════════════════════════════════════════
# Status Bar Configuration
# ═══════════════════════════════════════════════════════════════════
set -g status-interval 5                                # Update status bar every 5 seconds
set -g status-position top                              # Position status bar at top of terminal
set -g status-justify left                              # Left-align window list in status bar
set -g status-style fg=white,bg=black                   # Default status bar colors
set -g status-left-length 50                            # Maximum length of left status section
set -g status-right-length 50                           # Maximum length of right status section

# Left status: shows session name and current pane's running command
set -g status-left "#[fg=blue]Session: #S   "

# Right status: prefix indicator, time, date, username, and hostname
set -g status-right '#{?client_prefix,#[fg=black]#[bg=yellow] PREFIX #[default], } #[fg=blue]%I:%M %p#[default] #[fg=green]%a %b-%d#[default]'

# Window styling: black background for active and inactive windows
set -g window-active-style bg=black
set -g window-style bg=brightblack

# Window status format: shows window number and name with separator
set-window-option -g window-status-format "#[fg=brightwhite]#I:#W#[fg=brightblack]/"

# Active window format: green and bold for better visibility
set-window-option -g window-status-current-format "#[fg=green,bold]#I:#W#[fg=brightblack]/"

# Window status separator: spaces between window indicators
set-window-option -g window-status-separator "   "

# Activity and bell styling: visual indicators when content changes
set-window-option -g window-status-activity-style "fg=yellow,bold"
set-window-option -g window-status-bell-style "fg=red,bold"

# ═══════════════════════════════════════════════════════════════════
# Mouse
# ═══════════════════════════════════════════════════════════════════
# scroll up
bind -T root WheelUpPane if-shell -F "#{||:#{alternate_on},#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -e }
bind -T copy-mode-vi WheelUpPane select-pane \; send-keys -X -N 5 scroll-up
bind -T copy-mode WheelUpPane select-pane \; send-keys -X -N 5 scroll-up
# scroll down
bind -T copy-mode WheelDownPane select-pane \; send-keys -X -N 5 scroll-down
bind -T copy-mode-vi WheelDownPane select-pane \; send-keys -X -N 5 scroll-down
# mouse down (left click)
bind -T root MouseDown1Pane select-pane -t= \; send-keys -M
bind -T copy-mode-vi MouseDown1Pane select-pane
bind -T copy-mode MouseDown1Pane select-pane
# ═══════════════════════════════════════════════════════════════════
# Pane Configuration
# ═══════════════════════════════════════════════════════════════════
set -g pane-base-index 1                                # Start pane numbering at 1 instead of 0
set -g pane-border-style fg="brightblack"              # Dim border color for inactive panes
set -g pane-active-border-style fg=blue,bg=black       # Blue border for active pane
set -g message-style bg="green",fg="black"             # Message box styling
set -g message-command-style bg="brightblack",fg="white" # Command message styling
set -g display-panes-colour brightblue                 # Color for pane number display
set -g display-panes-active-colour brightyellow        # Color for active pane number
set -g history-limit 10000                             # Scrollback buffer size (lines)

# ═══════════════════════════════════════════════════════════════════
# Pane Management
# ═══════════════════════════════════════════════════════════════════
bind v split-window -h -c "#{pane_current_path}"       # Split horizontally, cwd preserved
bind u split-window -v -c "#{pane_current_path}"       # Split vertically, cwd preserved
bind x kill-pane                                        # Quick pane killing without confirmation

# Alternative split bindings using pipe character
bind | split-window -h -c "#{pane_current_path}"       # | key splits horizontally
bind - split-window -v -c "#{pane_current_path}"       # - key splits vertically

# Swap windows left/right with pane navigation
bind < swap-window -t -1\; select-window -t -1          # Swap current window left
bind > swap-window -t +1\; select-window -t +1          # Swap current window right

# ═══════════════════════════════════════════════════════════════════
# Pane Navigation (Arrow Keys)
# ═══════════════════════════════════════════════════════════════════
bind h select-pane -L                                   # Move left with h key
bind l select-pane -R                                   # Move right with l key
bind k select-pane -U                                   # Move up with k key
bind j select-pane -D                                   # Move down with j key

# Alt-based pane navigation (no prefix needed)
bind -n C-h select-pane -L                              # Alt+H moves left
bind -n C-j select-pane -D                              # Alt+J moves down
bind -n C-k select-pane -U                              # Alt+K moves up
bind -n C-l select-pane -R                              # Alt+L moves right

# Pane resizing with Alt+Arrow keys (5 cells at a time)
bind -n M-H resize-pane -L 5                            # Alt+Shift+H resizes left
bind -n M-J resize-pane -D 5                            # Alt+Shift+J resizes down
bind -n M-K resize-pane -U 5                            # Alt+Shift+K resizes up
bind -n M-L resize-pane -R 5                            # Alt+Shift+L resizes right

# ═══════════════════════════════════════════════════════════════════
# Window Management
# ═══════════════════════════════════════════════════════════════════
set -g base-index 1                                     # Start window numbering at 1
set -g renumber-windows on                              # Auto-renumber windows on close

# Quick window selection with number keys
bind 1 select-window -t 1                               # Go to window 1
bind 2 select-window -t 2                               # Go to window 2
bind 3 select-window -t 3                               # Go to window 3
bind 4 select-window -t 4                               # Go to window 4
bind 5 select-window -t 5                               # Go to window 5
bind 6 select-window -t 6                               # Go to window 6
bind 7 select-window -t 7                               # Go to window 7
bind 8 select-window -t 8                               # Go to window 8
bind 9 select-window -t 9                               # Go to window 9
bind 0 select-window -t 10                              # Go to window 10

# Window navigation
bind n new-window -c "#{pane_current_path}"            # New window with current directory
bind d detach-client                                   # Detach from current session
bind r command-prompt -p "Rename window to:" "rename-window '%%'"  # Prompt to rename window
bind R refresh-client                                   # Refresh tmux display

# Safe window killing with confirmation
bind w kill-window \; 

# ═══════════════════════════════════════════════════════════════════
# Activity Monitoring
# ═══════════════════════════════════════════════════════════════════
setw -g monitor-activity on                             # Monitor for activity in background panes
setw -g visual-activity on                              # Show visual indicator when activity occurs
setw -g automatic-rename on                             # Auto-rename window based on running command

# Focus events for better terminal integration
set -g focus-events on                                  # Enable focus events for vim, etc.

# Clock mode styling
setw -g clock-mode-colour green                        # Clock color in 24-hour format
setw -g clock-mode-style 24                             # Use 24-hour time format

# ═══════════════════════════════════════════════════════════════════
# Vi Mode Configuration (Copy Mode)
# ═══════════════════════════════════════════════════════════════════
set -g mode-keys vi                                     # Use vi keybindings in copy mode
set -g escape-time 1                                    # Quick escape delay for copy mode

# Enter copy mode
bind c copy-mode                                        # Press prefix+c to enter copy mode

# Navigation in copy mode
bind -T copy-mode-vi Escape send-keys -X cancel        # Escape exits copy mode
bind -T copy-mode-vi v send-keys -X begin-selection    # v starts visual selection
bind -T copy-mode-vi V send-keys -X select-line        # V selects entire lines
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel  # y copies and exits
bind -T copy-mode-vi Enter send-keys -X copy-selection-and-cancel  # Enter copies and exits
bind -T copy-mode-vi Space if -F "#{selection_present}" { send -X clear-selection } { send -X begin-selection }  # Space toggles selection

# Cursor movement in copy mode (standard vi keys)
bind -T copy-mode-vi j send-keys -X cursor-down         # j moves down
bind -T copy-mode-vi k send-keys -X cursor-up           # k moves up
bind -T copy-mode-vi h send-keys -X cursor-left         # h moves left
bind -T copy-mode-vi l send-keys -X cursor-right        # l moves right
bind -T copy-mode-vi w send-keys -X next-word           # w jumps to next word
bind -T copy-mode-vi b send-keys -X previous-word       # b jumps to previous word
bind -T copy-mode-vi 0 send-keys -X start-of-line       # 0 goes to line start
bind -T copy-mode-vi $ send-keys -X end-of-line         # $ goes to line end

# Page scrolling in copy mode
bind -T copy-mode-vi K send-keys -X halfpage-up         # K scrolls up half page
bind -T copy-mode-vi J send-keys -X halfpage-down       # J scrolls down half page
bind -T copy-mode-vi g send-keys -X top-line            # g goes to top
bind -T copy-mode-vi G send-keys -X bottom-line         # G goes to bottom

# Paste from tmux buffer
bind P paste-buffer                                     # P pastes the last buffer
bind -T copy-mode-vi p send-keys -X paste-buffer        # p pastes in copy mode

# ═══════════════════════════════════════════════════════════════════
# Session Management
# ═══════════════════════════════════════════════════════════════════
bind s command-prompt -p "Switch to session:" "switch-client -t '%%'"  # Switch sessions via prompt

# Session save/restore (for tmux-resurrect plugin)
bind S command-prompt -p "Save session to:" "save-buffer '%%'"         # Save session to file
bind R command-prompt -p "Restore session from:" "load-buffer '%%'"   # Restore session from file

# ═══════════════════════════════════════════════════════════════════
# Plugins Configuration
# ═══════════════════════════════════════════════════════════════════

# tmux-fzf-session-switch: fuzzy session switching
set -g @plugin 'vndmp4/tmux-fzf-session-switch'        # Plugin for fuzzy session switching
set -g @fzf-goto-session 's'                           # Press prefix+s to switch sessions
set -g @fzf-layout 'bottom'                            # Show fzf popup at bottom of screen
set -g @fzf-fuzzy-command ''                           # Enable fuzzy command search

# extrakto: fuzzy selection of content (urls, paths, etc.)
set -g @plugin 'laktak/extrakto'                       # Plugin for extracting content
set -g @extrakto_key 'e'                               # Press prefix+e to activate
set -g @extrakto_popup 'y'                             # Open in popup window

# tmux-fuzzback: fuzzy history search
set -g @plugin 'roosta/tmux-fuzzback'                  # Plugin for fuzzy history search
set -g @fuzzback-key 'f'                               # Press prefix+f to search history

# tmux-resurrect: save and restore tmux sessions
set -g @plugin 'tmux-plugins/tmux-resurrect'           # Plugin for session persistence
set -g @resurrect-capture-pane-contents 'on'           # Save pane scrollback history
set -g @resurrect-save 'S'                             # Press prefix+S to save session
set -g @resurrect-restore 'R'                          # Press prefix+R to restore session

# tmux-continuum: automatic session saving
set -g @plugin 'tmux-plugins/tmux-continuum'           # Plugin for auto-save/restore
set -g @continuum-save-interval '15'                   # Auto-save every 15 minutes
set -g @continuum-restore 'on'                         # Auto-restore on tmux start

# ═══════════════════════════════════════════════════════════════════
# Plugin Manager
# ═══════════════════════════════════════════════════════════════════
run "~/.tmux/plugins/tpm/tpm"                          # Initialize Tmux Plugin Manager
